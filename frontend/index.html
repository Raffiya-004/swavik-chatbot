<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWAVIK AI | Premium RAG Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap');

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: #f8fafc;
            overflow: hidden;
        }

        .neon-border {
            border: 1px solid rgba(56, 189, 248, 0.2);
            transition: all 0.3s ease;
        }

        .neon-border:hover {
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        .btn-pop {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-pop:hover {
            transform: scale(1.05) translateY(-2px);
        }

        .btn-pop:active {
            transform: scale(0.95);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(16px);
        }

        #chat-container {
            scroll-behavior: smooth;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior: contain;
            display: flex;
            flex-direction: column;
            flex: 1; 
            min-height: 0; 
        }

        .ai-message-glow {
            border-left: 4px solid #22d3ee;
            box-shadow: -10px 0 20px -10px rgba(34, 211, 238, 0.2);
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #22d3ee;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>

<body class="flex h-screen p-4 gap-4">

    <aside class="w-80 glass-card rounded-[2.5rem] p-8 flex flex-col border border-white/5 animate__animated animate__fadeInLeft">
        <div class="flex items-center gap-3 mb-12">
            <div class="bg-gradient-to-br from-cyan-400 to-blue-600 p-2.5 rounded-2xl shadow-lg">
                <i data-lucide="zap" class="text-white fill-current"></i>
            </div>
            <h1 class="text-2xl font-bold tracking-tighter italic">SWAVIK <span class="text-cyan-400">AI</span></h1>
        </div>

        <nav class="space-y-4 flex-1">
            <button onclick="showPage('dash')" id="nav-dash" class="nav-btn w-full flex items-center gap-4 px-6 py-4 rounded-2xl bg-white text-slate-900 font-bold btn-pop shadow-xl">
                <i data-lucide="layout-grid"></i> Dashboard üìä
            </button>
            <button onclick="showPage('chat')" id="nav-chat" class="nav-btn w-full flex items-center gap-4 px-6 py-4 rounded-2xl text-slate-400 hover:text-white hover:bg-white/5 btn-pop">
                <i data-lucide="message-circle"></i> AI Chatbot ü§ñ
            </button>
            <button onclick="showPage('upload')" id="nav-upload" class="nav-btn w-full flex items-center gap-4 px-6 py-4 rounded-2xl text-slate-400 hover:text-white hover:bg-white/5 btn-pop">
                <i data-lucide="database"></i> Knowledge Base üìö
            </button>
            <button onclick="showPage('files')" id="nav-files" class="nav-btn w-full flex items-center gap-4 px-6 py-4 rounded-2xl text-slate-400 hover:text-white hover:bg-white/5 btn-pop">
                <i data-lucide="folder-search"></i> Recent Files üìÅ
            </button>
        </nav>

        <div class="mt-auto p-6 bg-slate-800/50 rounded-3xl border border-white/5">
            <p class="text-[10px] uppercase tracking-widest text-slate-500 font-bold mb-2">System Status</p>
            <div class="flex items-center gap-2 text-emerald-400 text-sm font-bold">
                <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                </span>
                Secure Connection
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col gap-4 overflow-hidden relative">

        <div id="page-dash" class="page-content animate__animated animate__fadeIn">
            <header class="flex justify-between items-center mb-8 px-4">
                <div>
                    <h2 class="text-4xl font-extrabold tracking-tight">Welcome to Swavik Worldüëã</h2>
                    <p class="text-slate-500">Your HR knowledge system is synced and ready.</p>
                </div>
            </header>
            <div class="grid grid-cols-3 gap-6">
                <div class="glass-card p-8 rounded-[2.5rem] neon-border">
                    <i data-lucide="file-text" class="text-cyan-400 mb-6"></i>
                    <p class="text-slate-500 text-sm font-medium">Indexed Files</p>
                    <h3 class="text-4xl font-bold mt-1" id="stat-docs">0</h3>
                </div>
                <div class="glass-card p-8 rounded-[2.5rem] neon-border">
                    <i data-lucide="activity" class="text-purple-400 mb-6"></i>
                    <p class="text-slate-500 text-sm font-medium">Total Queries</p>
                    <h3 class="text-4xl font-bold mt-1">Ready</h3>
                </div>
                <div class="glass-card p-8 rounded-[2.5rem] neon-border">
                    <i data-lucide="shield-check" class="text-amber-400 mb-6"></i>
                    <p class="text-slate-500 text-sm font-medium">RAG Accuracy</p>
                    <h3 class="text-4xl font-bold mt-1">98.4%</h3>
                </div>
            </div>
        </div>

        <div id="page-chat" class="page-content hidden flex flex-col h-full max-w-5xl mx-auto w-full animate__animated animate__fadeIn">
            <div class="flex justify-between items-center p-4 border-b border-white/5 shrink-0">
                <h3 class="font-bold text-cyan-400 flex items-center gap-2"><i data-lucide="bot"></i> AI HR Expert</h3>
                <button onclick="exportChat()" class="text-xs bg-white/5 hover:bg-white/10 px-4 py-2 rounded-lg transition-all flex items-center gap-2">
                    <i data-lucide="download" size="14"></i> Export Chat
                </button>
            </div>

            <div id="chat-container" class="p-6 space-y-6">
                <div class="flex gap-4">
                    <div class="h-10 w-10 bg-cyan-500 rounded-xl flex items-center justify-center shadow-lg"><i data-lucide="bot" size="20"></i></div>
                    <div class="glass-card p-6 rounded-3xl rounded-tl-none max-w-xl border border-white/5">
                        Hello! I am Swavik's AI assistant. Ask me anything about your uploaded company policies! üõ°Ô∏è
                    </div>
                </div>
            </div>

            <div class="px-6 flex gap-2 overflow-x-auto pb-2 shrink-0">
                <button onclick="quickQuery('What is the leave policy?')" class="whitespace-nowrap bg-slate-800/50 border border-white/10 px-4 py-2 rounded-full text-xs hover:bg-cyan-500/20 transition-all">Leave Policy? ‚úàÔ∏è</button>
                <button onclick="quickQuery('What is the dress code?')" class="whitespace-nowrap bg-slate-800/50 border border-white/10 px-4 py-2 rounded-full text-xs hover:bg-cyan-500/20 transition-all">Dress Code? üëî</button>
                <button onclick="quickQuery('How do I get reimbursement?')" class="whitespace-nowrap bg-slate-800/50 border border-white/10 px-4 py-2 rounded-full text-xs hover:bg-cyan-500/20 transition-all">Reimbursement? üí∞</button>
            </div>

            <div class="p-6 shrink-0">
                <div class="relative flex items-center">
                    <input id="chat-input" type="text" placeholder="Type your query here..."
                        class="w-full bg-slate-800/50 border border-white/10 p-6 rounded-[2rem] outline-none focus:border-cyan-500/50 transition-all text-white pr-40 shadow-2xl">
                    <button onclick="sendQuery()" class="absolute right-3 bg-cyan-500 hover:bg-cyan-400 px-6 py-4 rounded-2xl font-bold text-slate-900 flex items-center gap-2 btn-pop shadow-lg">
                        Ask AI <i data-lucide="send" size="18"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="page-upload" class="page-content hidden flex items-center justify-center h-full animate__animated animate__zoomIn">
            <div class="glass-card p-16 rounded-[4rem] text-center border-2 border-dashed border-white/10 hover:border-cyan-500/30 transition-all w-full max-w-2xl">
                <i data-lucide="cloud-lightning" size="48" class="text-cyan-400 mx-auto mb-8"></i>
                <h2 class="text-3xl font-bold mb-4">Feed the AI Brain üß†</h2>
                <p class="text-slate-400 mb-10">Upload CSV/Excel documents to update the knowledge base.</p>
                <input type="file" id="fileInput" class="hidden" onchange="performUpload()">
                <button onclick="document.getElementById('fileInput').click()" class="bg-white text-slate-900 px-12 py-5 rounded-3xl font-black btn-pop shadow-2xl">
                    SELECT DOCUMENTS üìÅ
                </button>
                <p id="upload-status" class="mt-6 font-bold text-cyan-400 hidden italic">Syncing with database...</p>
            </div>
        </div>

        <div id="page-files" class="page-content hidden h-full overflow-y-auto p-8 animate__animated animate__fadeIn">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <i data-lucide="folder-search" class="text-cyan-400"></i> Recent Uploads
            </h2>
            <div id="file-list" class="space-y-4 max-w-4xl"></div>
        </div>

    </main>

    <script>
        const API_URL = "http://127.0.0.1:8000";
        lucide.createIcons();

        function showPage(pageId) {
            // Hide all pages first
            document.querySelectorAll('.page-content').forEach(p => {
                p.classList.add('hidden');
                p.style.display = 'none'; 
            });

            // Find and show selected page
            const targetPage = document.getElementById('page-' + pageId);
            if(targetPage) {
                targetPage.classList.remove('hidden');
                // Use flex only for the Chat page to maintain layout, block for others
                targetPage.style.display = (pageId === 'chat') ? 'flex' : 'block';
                if(pageId === 'upload') targetPage.style.display = 'flex'; // Also flex for centering upload button
            }

            // Update Nav buttons
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-slate-900', 'shadow-xl');
                b.classList.add('text-slate-400');
            });
            const activeBtn = document.getElementById('nav-' + pageId);
            if(activeBtn) {
                activeBtn.classList.remove('text-slate-400');
                activeBtn.classList.add('bg-white', 'text-slate-900', 'shadow-xl');
            }

            if (pageId === 'files') loadRecentFiles();
            if (pageId === 'chat') scrollToBottom();
        }

        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            if(container) {
                window.requestAnimationFrame(() => {
                    container.scrollTop = container.scrollHeight;
                });
            }
        }

        function quickQuery(question) {
            document.getElementById('chat-input').value = question;
            sendQuery();
        }

        async function sendQuery() {
            const input = document.getElementById('chat-input');
            const container = document.getElementById('chat-container');
            if (!input || !input.value) return;

            const text = input.value;
            container.innerHTML += `
                <div class="flex justify-end animate__animated animate__fadeInRight">
                    <div class="bg-cyan-500 p-6 rounded-3xl rounded-tr-none text-slate-900 font-bold max-w-xl shadow-lg shadow-cyan-500/20">
                        ${text}
                    </div>
                </div>`;
            
            input.value = '';
            scrollToBottom();

            const loadingId = "load-" + Date.now();
            container.innerHTML += `
                <div id="${loadingId}" class="flex gap-4 animate__animated animate__fadeIn">
                    <div class="h-10 w-10 bg-slate-800 rounded-xl flex items-center justify-center border border-white/10 text-cyan-400">
                        <i data-lucide="refresh-cw" class="animate-spin" size="18"></i>
                    </div>
                    <div class="glass-card p-6 rounded-3xl rounded-tl-none max-w-xl border border-white/5 ai-message-glow">
                        <div class="flex gap-1">
                            <div class="typing-dot" style="animation-delay: 0s"></div>
                            <div class="typing-dot" style="animation-delay: 0.2s"></div>
                            <div class="typing-dot" style="animation-delay: 0.4s"></div>
                        </div>
                    </div>
                </div>`;
            lucide.createIcons();
            scrollToBottom();

            try {
                const res = await axios.post(`${API_URL}/chat`, { text: text });
                document.getElementById(loadingId).remove();

                container.innerHTML += `
                    <div class="flex gap-4 animate__animated animate__fadeInLeft">
                        <div class="h-10 w-10 bg-slate-800 rounded-xl flex items-center justify-center border border-white/10 text-cyan-400">
                            <i data-lucide="bot" size="20"></i>
                        </div>
                        <div class="glass-card p-6 rounded-3xl rounded-tl-none max-w-xl border border-white/5 ai-message-glow">
                            <div class="text-xs font-bold text-cyan-500 mb-2 uppercase tracking-widest">AI Policy Response</div>
                            <div class="whitespace-pre-line text-slate-200">${res.data.answer}</div>
                            <div class="mt-4 pt-4 border-t border-white/10 flex justify-between items-center">
                                <div class="text-[9px] text-slate-500 uppercase font-bold tracking-widest">
                                    Sources: ${res.data.sources.join(', ')}
                                </div>
                                <span class="text-[9px] text-emerald-400 font-bold bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20">High Confidence</span>
                            </div>
                        </div>
                    </div>`;
                lucide.createIcons();
                scrollToBottom();
            } catch (e) {
                if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
                alert("Error: Ensure backend is running");
            }
        }

        async function performUpload() {
            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('upload-status');
            if(!fileInput.files[0]) return;

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            status.classList.remove('hidden');
            status.innerText = "Indexing Knowledge... ‚ö°";

            try {
                await axios.post(`${API_URL}/upload`, formData);
                status.innerText = "Database Updated! ‚úÖ";
                setTimeout(() => { status.classList.add('hidden'); fetchStats(); }, 2000);
            } catch (e) { status.innerText = "Upload failed ‚ùå"; }
        }

        async function fetchStats() {
            try {
                const res = await axios.get(`${API_URL}/stats`);
                document.getElementById('stat-docs').innerText = res.data.total_docs || 0;
            } catch (e) { console.warn("Stats fetch failed"); }
        }
        fetchStats();
        // komala
        async function loadRecentFiles() {
            const fileListDiv = document.getElementById('file-list');
            fileListDiv.innerHTML = '<p class="text-slate-500 animate-pulse">Syncing files...</p>';
            try {
                const res = await axios.get(`${API_URL}/files`);
                if(res.data.length === 0) {
                    fileListDiv.innerHTML = '<p class="text-slate-500 italic">No files in database.</p>';
                    return;
                }
                fileListDiv.innerHTML = res.data.map(file => `
                    <div class="glass-card p-6 rounded-3xl border border-white/5 flex items-center justify-between mb-3">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-cyan-500/10 rounded-2xl text-cyan-400"><i data-lucide="file-text"></i></div>
                            <div>
                                <p class="font-bold text-white">${file.name}</p>
                                <p class="text-xs text-slate-500">${file.date} ‚Ä¢ ${file.size}</p>
                            </div>
                        </div>
                        <span class="text-emerald-400 text-xs font-bold px-3 py-1 bg-emerald-400/10 rounded-full border border-emerald-400/20">READY</span>
                    </div>`).join('');
                lucide.createIcons();
            } catch (e) { fileListDiv.innerHTML = 'Error loading files.'; }
        }
    </script>
</body>
</html>
